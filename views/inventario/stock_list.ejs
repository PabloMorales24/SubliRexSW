<%- include('../partials/header') %>

<!-- Bootstrap & DataTables -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"  rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css"      rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

<div class="container-fluid py-4">

  <h1 class="h4 mb-4">Stock – Resumen global</h1>

  <table id="tblStock" class="table table-striped table-bordered align-middle w-100">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Producto</th>
        <th class="text-end">Stock&nbsp;total</th>
        <th class="text-end">Últ. costo&nbsp;(Q)</th>
        <th class="text-center">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <% productos.forEach(p => { %>
        <tr>
          <td><%= p.id %></td>
          <td><%= p.nombre %></td>
          <td class="text-end"><%= p.stock_total %></td>
          <td class="text-end">
            <%= p.ultimo_compra !== null ? (+p.ultimo_compra).toFixed(2) : '—' %>
          </td>
          <td class="text-center">

            <!-- Ver ficha (bodegas + precios) -->
            <a href="/inventario/productos/<%= p.id %>/inventario"
               class="btn btn-sm btn-primary me-1"
               title="Ver inventario">
              <i class="fa fa-eye"></i>
            </a>

            <!-- Añadir / actualizar inventario -->
            <a href="/inventario/productos/<%= p.id %>/inventario/nuevo"
               class="btn btn-sm btn-success"
               title="Agregar / editar inventario">
              <i class="fa fa-plus"></i>
            </a>

          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>

  <a href="/inventario/productos/nuevo" class="btn btn-success mt-3">
    <i class="fa fa-plus"></i> Nuevo producto
  </a>
  <a href="/inventario" class="btn btn-secondary mt-3">
    <i class="fa fa-arrow-left"></i> Menú Inventario
  </a>
</div>

<script>
  $(function () {
    $('#tblStock').DataTable({
      language : { url: '//cdn.datatables.net/plug-ins/1.13.8/i18n/es-ES.json' },
      order    : [[1,'asc']],
      pageLength: 10
    });
  });
</script>

<%- include('../partials/footer') %>
