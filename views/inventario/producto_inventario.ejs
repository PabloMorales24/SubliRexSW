<%- include('../partials/header') %>

<link  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

<style>
  .prod-card{border:1px solid #dee2e6;border-radius:.8rem;padding:1rem 1.25rem;background:#fff}
  .prod-img{width:100%;max-height:180px;object-fit:contain;margin-bottom:.5rem}
  th,td{vertical-align:middle}
</style>

<div class="container my-4">
  <!-- Cabecera -->
  <h1 class="text-center fw-bold"><%= producto.nombre %></h1>
  <% if(producto.descripcion){ %>
    <p class="text-center text-muted mb-4"><%= producto.descripcion %></p>
  <% } %>

  <div class="row g-4">
    <!-- ► Tarjeta producto -->
    <aside class="col-lg-4">
      <div class="prod-card">
        <% if(producto.imagen){ %>
          <img src="<%= producto.imagen %>" class="prod-img" alt="Producto">
        <% } %>
        <p class="mb-1"><strong>Marca:</strong> <%= producto.marca || '—' %></p>
        <p class="mb-1"><strong>Material:</strong> <%= producto.material || '—' %></p>
        <p class="mb-1"><strong>Color:</strong> <%= producto.color || '—' %></p>
        <p class="mb-1"><strong>Forma:</strong> <%= producto.forma || '—' %></p>
        <% if(producto.capacidad){ %>
          <p class="mb-1"><strong>Capacidad:</strong>
            <%= producto.capacidad %> <%= producto.unidad || '' %></p>
        <% } %>
        <% if(producto.precio_venta){ %>
          <p class="mb-0"><strong>P-venta sugerido:</strong>
            Q <%= (+producto.precio_venta).toFixed(2) %></p>
        <% } %>
      </div>
    </aside>

    <!-- ► Inventario  -->
    <section class="col-lg-8">
      <h4 class="border-bottom pb-2 mb-3">Existencias por bodega / proveedor</h4>
      <table class="table table-sm table-bordered">
        <thead class="table-light">
          <tr>
            <th>Bodega</th>
            <th>Proveedor</th>
            <th class="text-end">Cant.</th>
            <th class="text-end">Costo&nbsp;(Q)</th>
            <th class="text-end">Venta&nbsp;(Q)</th>
          </tr>
        </thead>
        <tbody>
          <% inventario.forEach(i=>{ %>
            <tr>
              <td><%= i.bodega %></td>
              <td><%= i.proveedor %></td>
              <td class="text-end"><%= i.cantidad %></td>
              <td class="text-end"><%= (+i.precio_compra).toFixed(2) %></td>
              <td class="text-end">
                <%= i.precio_venta ? (+i.precio_venta).toFixed(2) : '—' %>
              </td>
            </tr>
          <% }) %>
        </tbody>
        <tfoot class="table-light">
          <tr>
            <th colspan="3" class="text-end">Totales&nbsp;(Q)</th>
            <th class="text-end"><%= (+totales.total_compra||0).toFixed(2) %></th>
            <th class="text-end"><%= (+totales.total_venta ||0).toFixed(2) %></th>
          </tr>
        </tfoot>
      </table>

      <!-- ► Resumen proveedor -->
      <h4 class="border-bottom pb-2 mt-5 mb-3">Resumen por proveedor</h4>
      <table class="table table-sm table-bordered mb-4">
        <thead class="table-light">
          <tr>
            <th>Proveedor</th>
            <th class="text-end">Stock</th>
            <th class="text-end">Costo&nbsp;mín</th>
            <th class="text-end">Costo&nbsp;máx</th>
          </tr>
        </thead>
        <tbody>
          <% porProveedor.forEach(r=>{ %>
            <tr>
              <td><%= r.proveedor %></td>
              <td class="text-end"><%= r.stock %></td>
              <td class="text-end"><%= (+r.costo_min).toFixed(2) %></td>
              <td class="text-end"><%= (+r.costo_max).toFixed(2) %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>

      <a href="/inventario/productos/<%= producto.id %>/inventario/nuevo"
         class="btn btn-primary me-2">
        <i class="fa fa-plus"></i> Agregar inventario
      </a>
      <a href="/inventario/stock" class="btn btn-secondary">
        <i class="fa fa-arrow-left"></i> Volver al listado
      </a>
    </section>
  </div>
</div>

<%- include('../partials/footer') %>
