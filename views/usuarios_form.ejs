<%- include('partials/header', {
     title: data ? 'Editar usuario' : 'Nuevo usuario',
     user: user
}); %>

<h2 class="mb-4"><%= data ? '‚úèÔ∏è Editar usuario' : '‚ûï Nuevo usuario' %></h2>

<form class="row g-3" method="POST" enctype="multipart/form-data" autocomplete="on">
  <div class="col-md-6">
    <label class="form-label">Nombre</label>
    <input class="form-control" name="nombre" required value="<%= data?.nombre || '' %>">
  </div>

  <div class="col-md-6">
    <label class="form-label">Apellido</label>
    <input class="form-control" name="apellido" required value="<%= data?.apellido || '' %>">
  </div>

  <div class="col-md-6">
    <label class="form-label">Usuario</label>
    <input class="form-control" name="usuario" required value="<%= data?.usuario || '' %>" autocomplete="username">
  </div>

  <div class="col-md-6">
    <label class="form-label">Contrase√±a
      <small class="text-muted">(dejar vac√≠o si no deseas cambiarla)</small>
    </label>
    <div class="input-group">
      <input
        type="password"
        id="password"
        class="form-control"
        name="password"
        autocomplete="new-password">
      <button class="btn btn-outline-secondary" type="button" id="togglePwd" title="Mostrar/Ocultar contrase√±a">
        <span id="pwdIcon" aria-hidden="true">üëÅÔ∏è</span>
      </button>
    </div>
  </div>

  <div class="col-md-6">
    <label class="form-label">DPI</label>
    <input class="form-control" name="dpi" maxlength="13" value="<%= data?.dpi || '' %>">
  </div>

  <div class="col-md-6">
    <label class="form-label">Correo</label>
    <input type="email" class="form-control" name="correo" value="<%= data?.correo || '' %>">
  </div>

  <div class="col-md-6">
    <label class="form-label">Tel√©fono</label>
    <input class="form-control" name="telefono" value="<%= data?.telefono || '' %>">
  </div>

  <div class="col-md-6">
    <label class="form-label">Foto de perfil (opcional)</label>
    <input type="file" class="form-control" name="foto" accept="image/*">
  </div>

  <div class="col-md-6">
    <label class="form-label">Rol</label>
    <select class="form-select" name="rol_id" required>
      <% roles.forEach(r => { %>
        <option value="<%= r.id %>" <%= data && data.rol_id == r.id ? 'selected' : '' %>>
          <%= r.nombre %>
        </option>
      <% }) %>
    </select>
  </div>

  <div class="col-md-6">
    <label class="form-label">Estado</label>
    <select class="form-select" name="estado_id" required>
      <% estados.forEach(e => { %>
        <option value="<%= e.id %>" <%= data && data.estado_id == e.id ? 'selected' : '' %>>
          <%= e.nombre %>
        </option>
      <% }) %>
    </select>
  </div>

  <div class="col-12">
    <button class="btn btn-primary">
      <%= data ? 'Actualizar' : 'Crear' %>
    </button>
    <a href="/usuarios" class="btn btn-secondary ms-2">Cancelar</a>
  </div>
</form>

<script>
  // Mostrar / ocultar contrase√±a
  (function(){
    const pwd = document.getElementById('password');
    const btn = document.getElementById('togglePwd');
    const icon = document.getElementById('pwdIcon');

    if (pwd && btn) {
      btn.addEventListener('click', () => {
        const toShow = pwd.type === 'password';
        pwd.type = toShow ? 'text' : 'password';
        icon.textContent = toShow ? 'üôà' : 'üëÅÔ∏è';
        btn.setAttribute('aria-pressed', String(toShow));
      });
    }
  })();
</script>

<%- include('partials/footer'); %>
